<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Dashboard An√°lise Geral Funis - v6 Completo</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            min-height: 100vh;
            color: white;
            padding: 30px 20px;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
            touch-action: manipulation;
            overscroll-behavior: contain;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s;
        }

        .loading-screen.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 5px solid rgba(59, 130, 246, 0.2);
            border-top-color: #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            font-size: 1.1rem;
            color: #94a3b8;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            display: flex;
            flex-direction: column;
            gap: 10px;
            pointer-events: none;
        }

        .toast {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 16px 20px;
            min-width: 300px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: slideInRight 0.3s ease-out;
            pointer-events: all;
        }

        .toast.success { border-color: #10b981; }
        .toast.error { border-color: #ef4444; }
        .toast.warning { border-color: #f59e0b; }

        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-icon {
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 0.9rem;
            color: #cbd5e1;
        }

        /* Container Principal */
        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border-radius: 20px;
            border: 2px solid #3b82f6;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #60a5fa, #3b82f6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #94a3b8;
            font-size: 1.1rem;
        }

        /* Navigation Menu */
        .nav-menu {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #3b82f6;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .nav-btn {
            background: linear-gradient(135deg, #1e40af 0%, #1e3a8a 100%);
            color: white;
            border: 2px solid #3b82f6;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(59, 130, 246, 0.4);
            background: linear-gradient(135deg, #2563eb 0%, #1e40af 100%);
        }

        .nav-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #60a5fa;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.6);
        }

        /* Month Selector */
        .month-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .month-btn {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #475569;
            color: white;
            padding: 12px 30px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .month-btn:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .month-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #60a5fa;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        /* Team Selector */
        .team-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .team-btn {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #475569;
            color: white;
            padding: 14px 40px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            min-width: 150px;
        }

        .team-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .team-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #60a5fa;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        .team-btn.geral-btn.active {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            border-color: #a78bfa;
            box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        /* Product Selector */
        .product-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .product-btn {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #475569;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .product-btn:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .product-btn.active {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border-color: #60a5fa;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
        }

        /* Dashboard Content */
        .dashboard-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 30px;
            margin-bottom: 30px;
        }

        /* Main Chart */
        .main-chart {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #3b82f6;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .chart-title {
            font-size: 1.8rem;
            color: #60a5fa;
        }

        .week-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .week-selector label {
            font-weight: 600;
            color: #94a3b8;
        }

        .week-selector select {
            background: #0f172a;
            color: white;
            border: 2px solid #3b82f6;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }

        .week-selector select:hover {
            border-color: #60a5fa;
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.3);
        }

        /* Funnel Chart */
        #funnelArea {
            min-height: 500px;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .funnel-stage {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s;
        }

        .funnel-stage:hover {
            transform: translateX(10px);
            box-shadow: 0 5px 20px rgba(59, 130, 246, 0.3);
        }

        .funnel-stage-label {
            font-size: 1.2rem;
            font-weight: 600;
            color: #60a5fa;
        }

        .funnel-stage-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        .funnel-stage-bar {
            height: 8px;
            background: linear-gradient(90deg, #3b82f6, #60a5fa);
            border-radius: 4px;
            margin-top: 10px;
            transition: width 0.5s ease;
        }

        /* Stats Panel */
        .stats-panel {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .stats-block {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #3b82f6;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .stats-block.taxas {
            border-color: #8b5cf6;
        }

        .stats-block-title {
            font-size: 1.3rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #60a5fa;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .stats-block.taxas .stats-block-title {
            color: #a78bfa;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid #334155;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #94a3b8;
            font-weight: 500;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: white;
        }

        .stat-value.positive {
            color: #10b981;
        }

        .stat-value.negative {
            color: #ef4444;
        }

        .trend-indicator {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .trend-indicator.up {
            color: #10b981;
        }

        .trend-indicator.down {
            color: #ef4444;
        }

        /* Bottom Cards */
        .bottom-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #3b82f6;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(59, 130, 246, 0.4);
        }

        .metric-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .metric-card-title {
            font-size: 1rem;
            color: #94a3b8;
            font-weight: 600;
        }

        .metric-card-icon {
            font-size: 1.5rem;
        }

        .metric-card-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .metric-card-trend {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
        }

        /* Rankings */
        .ranking-section {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #3b82f6;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .ranking-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            text-align: center;
            color: #60a5fa;
        }

        .ranking-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
        }

        .ranking-card {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border: 2px solid #475569;
            border-radius: 16px;
            padding: 20px;
            transition: all 0.3s;
        }

        .ranking-card:hover {
            border-color: #3b82f6;
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.3);
        }

        .ranking-card-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 15px;
            color: #60a5fa;
            text-align: center;
        }

        .ranking-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 10px;
            transition: all 0.3s;
        }

        .ranking-item:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateX(5px);
        }

        .ranking-position {
            font-size: 1.5rem;
            font-weight: 700;
            min-width: 40px;
            text-align: center;
        }

        .ranking-position.gold { color: #fbbf24; }
        .ranking-position.silver { color: #cbd5e1; }
        .ranking-position.bronze { color: #fb923c; }

        .ranking-info {
            flex: 1;
        }

        .ranking-product-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .ranking-value {
            color: #94a3b8;
            font-size: 0.9rem;
        }

        /* Module Views */
        .module-view {
            display: none;
        }

        .module-view.active {
            display: block;
        }

        /* ROI Grid */
        .roi-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .roi-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #3b82f6;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .roi-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 50px rgba(59, 130, 246, 0.4);
        }

        .roi-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #334155;
        }

        .roi-card-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: #60a5fa;
        }

        .roi-card-icon {
            font-size: 1.8rem;
        }

        .roi-metrics {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .roi-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .roi-metric-label {
            color: #94a3b8;
            font-weight: 500;
        }

        .roi-metric-value {
            font-size: 1.4rem;
            font-weight: 700;
        }

        .roi-metric-value.profit {
            color: #10b981;
        }

        .roi-metric-value.loss {
            color: #ef4444;
        }

        /* Insights Container */
        .insights-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .insight-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #3b82f6;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            transition: all 0.3s;
        }

        .insight-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 50px rgba(59, 130, 246, 0.4);
        }

        .insight-card.positive {
            border-color: #10b981;
        }

        .insight-card.negative {
            border-color: #ef4444;
        }

        .insight-card.neutral {
            border-color: #f59e0b;
        }

        .insight-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 15px;
        }

        .insight-icon {
            font-size: 1.8rem;
        }

        .insight-title {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .insight-description {
            color: #cbd5e1;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .insight-data {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .insight-data-item {
            background: rgba(59, 130, 246, 0.1);
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: 600;
        }

        /* Comparison Module */
        .product-selector-comparison {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .product-select-wrapper {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .product-select-label {
            font-weight: 600;
            color: #94a3b8;
        }

        .product-select-wrapper select {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            color: white;
            border: 2px solid #3b82f6;
            padding: 12px 20px;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            min-width: 200px;
        }

        .comparison-vs {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
        }

        .comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .comparison-column {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #3b82f6;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .comparison-column-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #334155;
        }

        .comparison-product-name {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
        }

        .comparison-metrics {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .comparison-metric {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 10px;
        }

        .comparison-metric-label {
            color: #94a3b8;
            font-weight: 600;
        }

        .comparison-metric-value {
            font-size: 1.3rem;
            font-weight: 700;
        }

        /* Month Comparison */
        .month-comparison-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .month-comparison-column {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            border: 2px solid #3b82f6;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .month-comparison-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 2px solid #334155;
        }

        .month-comparison-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #60a5fa;
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .dashboard-content {
                grid-template-columns: 1fr;
            }

            .stats-panel {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
                gap: 20px;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 15px 10px;
            }

            .header h1 {
                font-size: 1.8rem;
            }

            .header p {
                font-size: 0.95rem;
            }

            .nav-menu {
                padding: 15px;
                gap: 10px;
            }

            .nav-btn {
                padding: 10px 18px;
                font-size: 0.9rem;
            }

            .month-btn {
                padding: 10px 20px;
                font-size: 0.95rem;
            }

            .team-btn {
                padding: 12px 30px;
                font-size: 1rem;
                min-width: 120px;
            }

            .product-btn {
                padding: 10px 18px;
                font-size: 0.9rem;
            }

            .chart-title {
                font-size: 1.4rem;
            }

            .week-selector {
                width: 100%;
                justify-content: space-between;
            }

            .funnel-stage {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .stats-panel {
                grid-template-columns: 1fr;
            }

            .bottom-cards {
                grid-template-columns: 1fr;
            }

            .ranking-grid {
                grid-template-columns: 1fr;
            }

            .comparison-grid,
            .month-comparison-grid {
                grid-template-columns: 1fr;
            }

            .product-selector-comparison {
                flex-direction: column;
                gap: 15px;
            }

            .product-select-wrapper {
                width: 100%;
                flex-direction: column;
            }

            .product-select-wrapper select {
                width: 100%;
            }

            .comparison-vs {
                font-size: 1.2rem;
            }

            .toast {
                min-width: 280px;
            }

            .toast-container {
                right: 10px;
                left: 10px;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .chart-title {
                font-size: 1.2rem;
            }

            .metric-card-value {
                font-size: 1.6rem;
            }

            .roi-card-name {
                font-size: 1.1rem;
            }

            .roi-metric-value {
                font-size: 1.2rem;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <div class="loading-spinner"></div>
        <div class="loading-text">Carregando dados da planilha...</div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <div class="container">
        <!-- Navigation Menu -->
        <div class="nav-menu">
            <button class="nav-btn active" onclick="showModule('dashboard')">
                üìä Dashboard Principal
            </button>
            <button class="nav-btn" onclick="showModule('roi')">
                üí∞ ROI/ROAS
            </button>
            <button class="nav-btn" onclick="showModule('custos')">
                üìä Custo por Lead
            </button>
            <button class="nav-btn" onclick="showModule('insights')">
                ü§ñ Insights
            </button>
            <button class="nav-btn" onclick="showModule('comparar-funis')">
                ‚öñÔ∏è Comparar Funis
            </button>
            <button class="nav-btn" onclick="showModule('comparar-meses')">
                üìÖ Comparar Meses
            </button>
            <button class="nav-btn" onclick="exportData('pdf')">
                üì• Exportar PDF
            </button>
        </div>

        <!-- MODULE: Dashboard Principal -->
        <div class="module-view active" id="module-dashboard">
            <div class="header">
                <h1>üìä ACOMPANHAMENTO GERAL FUNIS</h1>
                <p>An√°lise Completa de Performance por Produto - v6</p>
            </div>

            <div class="month-selector" id="monthSelector"></div>

            <div class="team-selector">
                <button class="team-btn geral-btn active" onclick="selectTeam('geral')">
                    üìä GERAL
                </button>
                <button class="team-btn" onclick="selectTeam('cleiton')">
                    üë®‚Äçüíº CLEITON
                </button>
                <button class="team-btn" onclick="selectTeam('julia')">
                    üë©‚Äçüíº JULIA
                </button>
            </div>

            <div class="product-selector" id="productSelector"></div>

            <div class="dashboard-content">
                <div class="main-chart">
                    <div class="chart-header">
                        <h2 class="chart-title" id="chartTitle">Funil de Convers√£o</h2>
                        <div class="week-selector">
                            <label for="weekSelect">üìÖ Per√≠odo:</label>
                            <select id="weekSelect" onchange="updateFunnel()">
                                <option value="total">Total do M√™s</option>
                                <option value="1">Semana 1</option>
                                <option value="2">Semana 2</option>
                                <option value="3">Semana 3</option>
                                <option value="4">Semana 4</option>
                            </select>
                        </div>
                    </div>
                    <div id="funnelArea"></div>
                </div>

                <div class="stats-panel" id="statsPanel"></div>
            </div>

            <div class="bottom-cards" id="bottomCards"></div>

            <div class="ranking-section">
                <h2 class="ranking-title">üèÜ RANKING DE PRODUTOS - COMPARA√á√ÉO</h2>
                <div class="ranking-grid" id="rankingGrid"></div>
            </div>
        </div>

        <!-- MODULE: ROI/ROAS -->
        <div class="module-view" id="module-roi">
            <div class="header">
                <h1>üí∞ AN√ÅLISE DE LUCRO E ROAS</h1>
                <p>Lucro Absoluto e Retorno sobre Investimento</p>
            </div>
            <div class="month-selector" id="monthSelectorROI"></div>
            <div class="roi-grid" id="roiGrid"></div>
        </div>

        <!-- MODULE: Custo por Lead -->
        <div class="module-view" id="module-custos">
            <div class="header">
                <h1>üìä CUSTO POR LEAD/VENDA</h1>
                <p>An√°lise de CAC e Efici√™ncia</p>
            </div>
            <div class="month-selector" id="monthSelectorCustos"></div>
            <div class="roi-grid" id="custosGrid"></div>
        </div>

        <!-- MODULE: Insights -->
        <div class="module-view" id="module-insights">
            <div class="header">
                <h1>ü§ñ INSIGHTS AUTOM√ÅTICOS</h1>
                <p>An√°lise Inteligente dos Dados</p>
            </div>
            <div class="month-selector" id="monthSelectorInsights"></div>
            <div class="insights-container" id="insightsContainer"></div>
        </div>

        <!-- MODULE: Comparar Funis -->
        <div class="module-view" id="module-comparar-funis">
            <div class="header">
                <h1>‚öñÔ∏è COMPARA√á√ÉO ENTRE FUNIS</h1>
                <p>Compare a Performance de Dois Produtos Lado a Lado</p>
            </div>
            
            <div class="month-selector" id="monthSelectorComparacaoFunis"></div>
            
            <div class="product-selector-comparison">
                <div class="product-select-wrapper">
                    <span class="product-select-label">üéØ Funil 1:</span>
                    <select id="funil1Select" onchange="updateFunilComparison()">
                        <option value="GERAL">üìä GERAL</option>
                        <option value="Total Cleiton">üë®‚Äçüíº Total Cleiton</option>
                        <option value="50 Scripts">üìù 50 Scripts</option>
                        <option value="Couply">üíë Couply</option>
                        <option value="Social Selling CL">üì± Social Selling CL</option>
                        <option value="Total Julia">üë©‚Äçüíº Total Julia</option>
                        <option value="Teste">üß™ Teste</option>
                        <option value="IA Julia">ü§ñ IA Julia</option>
                        <option value="MPM">üìà MPM</option>
                        <option value="Autentiq">üîê Autentiq</option>
                        <option value="Mentoria Julia">üéì Mentoria Julia</option>
                        <option value="Social Selling JU">üíº Social Selling JU</option>
                    </select>
                </div>
                <div class="comparison-vs">VS</div>
                <div class="product-select-wrapper">
                    <span class="product-select-label">üéØ Funil 2:</span>
                    <select id="funil2Select" onchange="updateFunilComparison()">
                        <option value="GERAL">üìä GERAL</option>
                        <option value="Total Cleiton">üë®‚Äçüíº Total Cleiton</option>
                        <option value="50 Scripts">üìù 50 Scripts</option>
                        <option value="Couply">üíë Couply</option>
                        <option value="Social Selling CL">üì± Social Selling CL</option>
                        <option value="Total Julia">üë©‚Äçüíº Total Julia</option>
                        <option value="Teste">üß™ Teste</option>
                        <option value="IA Julia">ü§ñ IA Julia</option>
                        <option value="MPM">üìà MPM</option>
                        <option value="Autentiq">üîê Autentiq</option>
                        <option value="Mentoria Julia">üéì Mentoria Julia</option>
                        <option value="Social Selling JU" selected>üíº Social Selling JU</option>
                    </select>
                </div>
            </div>

            <div class="comparison-grid" id="comparisonGrid"></div>
        </div>

        <!-- MODULE: Comparar Meses -->
        <div class="module-view" id="module-comparar-meses">
            <div class="header">
                <h1>üìÖ COMPARA√á√ÉO ENTRE MESES</h1>
                <p>Evolu√ß√£o de Performance ao Longo do Tempo</p>
            </div>

            <div class="product-selector-comparison">
                <div class="product-select-wrapper">
                    <span class="product-select-label">üìÖ M√™s 1:</span>
                    <select id="mes1Select" onchange="updateMonthComparison()">
                        <option value="nov">Novembro</option>
                        <option value="out">Outubro</option>
                        <option value="set">Setembro</option>
                        <option value="ago">Agosto</option>
                        <option value="jul">Julho</option>
                    </select>
                </div>
                <div class="comparison-vs">VS</div>
                <div class="product-select-wrapper">
                    <span class="product-select-label">üìÖ M√™s 2:</span>
                    <select id="mes2Select" onchange="updateMonthComparison()">
                        <option value="nov">Novembro</option>
                        <option value="out" selected>Outubro</option>
                        <option value="set">Setembro</option>
                        <option value="ago">Agosto</option>
                        <option value="jul">Julho</option>
                    </select>
                </div>
            </div>

            <div class="product-select-wrapper" style="justify-content: center; margin-bottom: 30px;">
                <span class="product-select-label">üéØ Produto:</span>
                <select id="produtoMesSelect" onchange="updateMonthComparison()">
                    <option value="GERAL">üìä GERAL</option>
                    <option value="Total Cleiton">üë®‚Äçüíº Total Cleiton</option>
                    <option value="50 Scripts">üìù 50 Scripts</option>
                    <option value="Couply">üíë Couply</option>
                    <option value="Social Selling CL">üì± Social Selling CL</option>
                    <option value="Total Julia">üë©‚Äçüíº Total Julia</option>
                    <option value="Teste">üß™ Teste</option>
                    <option value="IA Julia">ü§ñ IA Julia</option>
                    <option value="MPM">üìà MPM</option>
                    <option value="Autentiq">üîê Autentiq</option>
                    <option value="Mentoria Julia">üéì Mentoria Julia</option>
                    <option value="Social Selling JU">üíº Social Selling JU</option>
                </select>
            </div>

            <div class="month-comparison-grid" id="monthComparisonGrid"></div>
        </div>
    </div>

    <script>
        // ==================== CONFIGURA√á√ïES GLOBAIS ====================
        // CORRIGIDO: Sheet ID e GID corretos da sua planilha
        const SHEET_ID = '1V0-yWzGbDWUEQ21CPtNcHrzPQfLTXKHNBYUlSfzO2Pc';
        const GID = '799831430';
        
        let allData = {};
        let currentMonth = 'nov';
        let currentTeam = 'geral';
        let currentProduct = 'GERAL';

        const months = [
            { id: 'nov', name: 'Novembro' },
            { id: 'out', name: 'Outubro' },
            { id: 'set', name: 'Setembro' },
            { id: 'ago', name: 'Agosto' },
            { id: 'jul', name: 'Julho' }
        ];

        const allProducts = [
            { id: 'GERAL', name: 'GERAL', icon: 'üìä', team: 'geral' },
            { id: 'Total Cleiton', name: 'Total Cleiton', icon: 'üë®‚Äçüíº', team: 'cleiton' },
            { id: '50 Scripts', name: '50 Scripts', icon: 'üìù', team: 'cleiton' },
            { id: 'Couply', name: 'Couply', icon: 'üíë', team: 'cleiton' },
            { id: 'Social Selling CL', name: 'Social Selling CL', icon: 'üì±', team: 'cleiton' },
            { id: 'Total Julia', name: 'Total Julia', icon: 'üë©‚Äçüíº', team: 'julia' },
            { id: 'Teste', name: 'Teste', icon: 'üß™', team: 'julia' },
            { id: 'IA Julia', name: 'IA Julia', icon: 'ü§ñ', team: 'julia' },
            { id: 'MPM', name: 'MPM', icon: 'üìà', team: 'julia' },
            { id: 'Autentiq', name: 'Autentiq', icon: 'üîê', team: 'julia' },
            { id: 'Mentoria Julia', name: 'Mentoria Julia', icon: 'üéì', team: 'julia' },
            { id: 'Social Selling JU', name: 'Social Selling JU', icon: 'üíº', team: 'julia' }
        ];

        // ==================== TOAST NOTIFICATIONS ====================
        function showToast(title, message, type = 'success', duration = 3000) {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            const icons = {
                success: '‚úÖ',
                error: '‚ùå',
                warning: '‚ö†Ô∏è',
                info: '‚ÑπÔ∏è'
            };
            
            toast.innerHTML = `
                <div class="toast-icon">${icons[type] || icons.info}</div>
                <div class="toast-content">
                    <div class="toast-title">${title}</div>
                    <div class="toast-message">${message}</div>
                </div>
            `;
            
            container.appendChild(toast);
            
            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s ease-out';
                setTimeout(() => toast.remove(), 300);
            }, duration);
        }

        // ==================== PARSING DE DADOS ====================
        function parseValue(value) {
            if (!value || value === '' || value === '-' || value === '#N/A' || value === '#DIV/0!') {
                return 0;
            }
            
            const cleanValue = value.toString()
                .replace(/[^\d,.-]/g, '')
                .replace(',', '.');
            
            const parsed = parseFloat(cleanValue);
            return isNaN(parsed) ? 0 : parsed;
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function formatNumber(value) {
            return new Intl.NumberFormat('pt-BR').format(Math.round(value));
        }

        function formatPercent(value) {
            return `${value.toFixed(2)}%`;
        }

        // ==================== BUSCA DIN√ÇMICA DE LINHAS ====================
        function findRowByName(rows, productName) {
            for (let i = 0; i < rows.length; i++) {
                if (rows[i][0] && rows[i][0].toString().trim() === productName) {
                    return i;
                }
            }
            console.warn(`‚ö†Ô∏è Produto n√£o encontrado: ${productName}`);
            return -1;
        }

        function parseSheetData(rows) {
            console.log(`üîç Parseando dados da planilha (${rows.length} linhas)...`);
            const monthData = {};
            
            // Buscar cada produto individualmente - INCLUINDO O GERAL
            const productsToSearch = [
                'GERAL',
                'Total Cleiton', '50 Scripts', 'Couply', 'Social Selling CL',
                'Total Julia', 'Teste', 'IA Julia', 'MPM', 'Autentiq',
                'Mentoria Julia', 'Social Selling JU'
            ];
            
            productsToSearch.forEach(productName => {
                const startRow = findRowByName(rows, productName);
                
                if (startRow === -1) {
                    console.warn(`‚ö†Ô∏è ${productName} n√£o encontrado`);
                    return;
                }
                
                // Criar estrutura de dados para o produto
                monthData[productName] = {
                    semana1: {},
                    semana2: {},
                    semana3: {},
                    semana4: {},
                    tendencia: {},
                    total: {}
                };
                
                // Parse das 5 linhas (4 semanas + tend√™ncia)
                // A estrutura √©: Linha do nome + 4 linhas de semanas + 1 linha de tend√™ncia
                for (let i = 1; i <= 5; i++) {
                    const row = rows[startRow + i];
                    if (!row) continue;
                    
                    const weekKey = i === 5 ? 'tendencia' : `semana${i}`;
                    
                    monthData[productName][weekKey] = {
                        investido: parseValue(row[1]),           // B - Investido
                        faturamentoTrafego: parseValue(row[2]),  // C - Faturamento tr√°fego
                        lucro: parseValue(row[3]),               // D - Roas Tr√°fego (na verdade √© LUCRO)
                        alunos: parseValue(row[4]),              // E - N√∫mero de alunos
                        qualificados: parseValue(row[5]),        // F - Qualificados
                        agendados: parseValue(row[6]),           // G - Agendados
                        taxaAgendamento: parseValue(row[7]),     // H - Taxa de agendamento
                        callRealizada: parseValue(row[8]),       // I - Call realizada
                        taxaComparecimento: parseValue(row[9]),  // J - Taxa de comparecimento
                        numeroVenda: parseValue(row[10]),        // K - N√∫mero de venda
                        taxaConversao: parseValue(row[11]),      // L - Taxa de convers√£o
                        taxaAscensao: parseValue(row[12]),       // M - Taxa de ascens√£o
                        vendaMonetizacao: parseValue(row[13]),   // N - Venda monetiza√ß√£o
                        entradaMonetizacao: parseValue(row[14]), // O - Entrada monetiza√ß√£o
                        faturamento: parseValue(row[15]),        // P - Faturamento do funil
                        roas: parseValue(row[16])                // Q - Roas do funil
                    };
                    
                    // Calcular ROI baseado em lucro e investido
                    if (monthData[productName][weekKey].investido > 0) {
                        monthData[productName][weekKey].roi = 
                            (monthData[productName][weekKey].lucro / monthData[productName][weekKey].investido) * 100;
                    } else {
                        monthData[productName][weekKey].roi = 0;
                    }
                }
                
                // Calcular totais do m√™s
                monthData[productName].total = {
                    investido: 0,
                    faturamento: 0,
                    lucro: 0,
                    roi: 0,
                    roas: 0,
                    alunos: 0,
                    callRealizada: 0,
                    qualificados: 0,
                    agendados: 0,
                    taxaAgendamento: 0,
                    taxaComparecimento: 0,
                    taxaAscensao: 0,
                    numeroVenda: 0,
                    vendaMonetizacao: 0,
                    entradaMonetizacao: 0
                };
                
                for (let i = 1; i <= 4; i++) {
                    const week = monthData[productName][`semana${i}`];
                    monthData[productName].total.investido += week.investido;
                    monthData[productName].total.faturamento += week.faturamento;
                    monthData[productName].total.lucro += week.lucro;
                    monthData[productName].total.alunos += week.alunos;
                    monthData[productName].total.callRealizada += week.callRealizada;
                    monthData[productName].total.qualificados += week.qualificados;
                    monthData[productName].total.agendados += week.agendados;
                    monthData[productName].total.numeroVenda += week.numeroVenda;
                    monthData[productName].total.vendaMonetizacao += week.vendaMonetizacao;
                    monthData[productName].total.entradaMonetizacao += week.entradaMonetizacao;
                }
                
                // Calcular m√©dias e taxas
                const total = monthData[productName].total;
                total.roi = total.investido > 0 ? (total.lucro / total.investido) * 100 : 0;
                total.roas = total.investido > 0 ? total.faturamento / total.investido : 0;
                total.taxaAgendamento = total.qualificados > 0 ? (total.agendados / total.qualificados) * 100 : 0;
                total.taxaComparecimento = total.agendados > 0 ? (total.callRealizada / total.agendados) * 100 : 0;
                total.taxaAscensao = total.callRealizada > 0 ? (total.alunos / total.callRealizada) * 100 : 0;
                
                console.log(`‚úÖ ${productName} parseado com sucesso`);
            });
            
            return monthData;
        }

        // ==================== CARREGAMENTO DE DADOS ====================
        async function loadSheetData() {
            document.getElementById('loadingScreen').classList.remove('hidden');
            
            try {
                console.log(`üìÖ Carregando dados da planilha...`);
                
                // URL corrigida com o Sheet ID e GID corretos
                const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;
                
                console.log(`üîó URL: ${url}`);
                
                const response = await fetch(url);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const csvText = await response.text();
                
                console.log(`üìÑ CSV carregado (${csvText.length} caracteres)`);
                
                const parsed = Papa.parse(csvText, { skipEmptyLines: true });
                
                console.log(`üìä Linhas parseadas: ${parsed.data.length}`);
                
                // Parse dos dados para novembro (assumindo que √© o primeiro m√™s na planilha)
                allData['nov'] = parseSheetData(parsed.data);
                
                console.log('üéâ Dados carregados com sucesso!', allData);
                
                initializeDashboard();
                
                setTimeout(() => {
                    document.getElementById('loadingScreen').classList.add('hidden');
                    showToast('Sucesso!', 'Dashboard carregado com sucesso', 'success', 5000);
                }, 500);
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar dados:', error);
                showToast('Erro', `Falha ao carregar os dados: ${error.message}`, 'error', 5000);
                document.getElementById('loadingScreen').classList.add('hidden');
            }
        }

        // ==================== INICIALIZA√á√ÉO DO DASHBOARD ====================
        function initializeDashboard() {
            renderMonthSelector();
            renderProductSelector();
            updateFunnel();
            renderRankings();
        }

        function renderMonthSelector() {
            const selectors = ['monthSelector', 'monthSelectorROI', 'monthSelectorCustos', 
                             'monthSelectorInsights', 'monthSelectorComparacaoFunis'];
            
            selectors.forEach(selectorId => {
                const container = document.getElementById(selectorId);
                if (!container) return;
                
                container.innerHTML = months.map(month => `
                    <button class="month-btn ${month.id === currentMonth ? 'active' : ''}" 
                            onclick="selectMonth('${month.id}', '${selectorId}')">
                        ${month.name}
                    </button>
                `).join('');
            });
        }

        function selectMonth(monthId, selectorId = 'monthSelector') {
            currentMonth = monthId;
            
            // Atualizar bot√µes ativos
            document.querySelectorAll('.month-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const selector = document.getElementById(selectorId);
            if (selector) {
                const buttons = selector.querySelectorAll('.month-btn');
                buttons.forEach(btn => {
                    if (btn.textContent.trim().toLowerCase().includes(monthId)) {
                        btn.classList.add('active');
                    }
                });
            }
            
            // Atualizar visualiza√ß√£o baseado no m√≥dulo ativo
            const activeModule = document.querySelector('.module-view.active');
            if (activeModule) {
                const moduleId = activeModule.id;
                
                if (moduleId === 'module-dashboard') {
                    updateFunnel();
                    renderRankings();
                } else if (moduleId === 'module-roi') {
                    renderROIModule();
                } else if (moduleId === 'module-custos') {
                    renderCustosModule();
                } else if (moduleId === 'module-insights') {
                    renderInsights();
                } else if (moduleId === 'module-comparar-funis') {
                    updateFunilComparison();
                }
            }
        }

        function selectTeam(team) {
            currentTeam = team;
            
            document.querySelectorAll('.team-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            if (team === 'geral') {
                currentProduct = 'GERAL';
            } else if (team === 'cleiton') {
                currentProduct = 'Total Cleiton';
            } else if (team === 'julia') {
                currentProduct = 'Total Julia';
            }
            
            renderProductSelector();
            updateFunnel();
        }

        function renderProductSelector() {
            const container = document.getElementById('productSelector');
            
            let products = [];
            if (currentTeam === 'geral') {
                products = allProducts.filter(p => p.id === 'GERAL');
            } else {
                products = allProducts.filter(p => p.team === currentTeam);
            }
            
            container.innerHTML = products.map(product => `
                <button class="product-btn ${product.id === currentProduct ? 'active' : ''}" 
                        onclick="selectProduct('${product.id}')">
                    ${product.icon} ${product.name}
                </button>
            `).join('');
        }

        function selectProduct(productId) {
            currentProduct = productId;
            
            document.querySelectorAll('.product-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            event.target.classList.add('active');
            
            updateFunnel();
        }

        // ==================== RENDERIZA√á√ÉO DO FUNIL ====================
        function updateFunnel() {
            const weekSelect = document.getElementById('weekSelect');
            const selectedWeek = weekSelect ? weekSelect.value : 'total';
            
            const monthData = allData[currentMonth];
            if (!monthData || !monthData[currentProduct]) {
                console.error(`Dados n√£o encontrados para ${currentProduct} em ${currentMonth}`);
                return;
            }
            
            let data;
            if (selectedWeek === 'total') {
                data = monthData[currentProduct].total;
            } else {
                data = monthData[currentProduct][`semana${selectedWeek}`];
            }
            
            // Atualizar t√≠tulo
            document.getElementById('chartTitle').textContent = 
                `Funil de Convers√£o - ${currentProduct}`;
            
            // Renderizar funil
            renderFunnel(data);
            
            // Renderizar stats panel
            renderStatsPanel(data, monthData[currentProduct]);
            
            // Renderizar bottom cards
            renderBottomCards(data);
        }

        function renderFunnel(data) {
            const funnelArea = document.getElementById('funnelArea');
            
            const stages = [
                { label: 'Qualificados', value: data.qualificados, color: '#3b82f6' },
                { label: 'Agendados', value: data.agendados, color: '#8b5cf6' },
                { label: 'Call Realizada', value: data.callRealizada, color: '#10b981' },
                { label: 'Alunos', value: data.alunos, color: '#f59e0b' }
            ];
            
            const maxValue = Math.max(...stages.map(s => s.value));
            
            funnelArea.innerHTML = stages.map(stage => {
                const percentage = maxValue > 0 ? (stage.value / maxValue) * 100 : 0;
                
                return `
                    <div class="funnel-stage">
                        <div style="flex: 1;">
                            <div class="funnel-stage-label">${stage.label}</div>
                            <div class="funnel-stage-value">${formatNumber(stage.value)}</div>
                            <div class="funnel-stage-bar" style="width: ${percentage}%; background: ${stage.color};"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderStatsPanel(data, productData) {
            const statsPanel = document.getElementById('statsPanel');
            
            const tendencia = productData.tendencia;
            
            statsPanel.innerHTML = `
                <!-- Bloco Financeiro -->
                <div class="stats-block">
                    <div class="stats-block-title">üí∞ FINANCEIRO</div>
                    <div class="stat-item">
                        <span class="stat-label">Investido</span>
                        <span class="stat-value">${formatCurrency(data.investido)}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Faturamento</span>
                        <span class="stat-value">${formatCurrency(data.faturamento)}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Lucro</span>
                        <span class="stat-value ${data.lucro >= 0 ? 'positive' : 'negative'}">
                            ${formatCurrency(data.lucro)}
                        </span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ROI</span>
                        <span class="stat-value ${data.roi >= 0 ? 'positive' : 'negative'}">
                            ${formatPercent(data.roi)}
                            ${tendencia ? `
                                <div class="trend-indicator ${tendencia.roi > data.roi ? 'up' : 'down'}">
                                    ${tendencia.roi > data.roi ? '‚Üó' : '‚Üò'} Tend√™ncia: ${formatPercent(tendencia.roi)}
                                </div>
                            ` : ''}
                        </span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ROAS</span>
                        <span class="stat-value">
                            ${data.roas.toFixed(2)}x
                            ${tendencia ? `
                                <div class="trend-indicator ${tendencia.roas > data.roas ? 'up' : 'down'}">
                                    ${tendencia.roas > data.roas ? '‚Üó' : '‚Üò'} Tend√™ncia: ${tendencia.roas.toFixed(2)}x
                                </div>
                            ` : ''}
                        </span>
                    </div>
                </div>

                <!-- Bloco Taxas -->
                <div class="stats-block taxas">
                    <div class="stats-block-title">üìä TAXAS</div>
                    <div class="stat-item">
                        <span class="stat-label">Taxa de Agendamento</span>
                        <span class="stat-value">
                            ${formatPercent(data.taxaAgendamento)}
                            ${tendencia ? `
                                <div class="trend-indicator ${tendencia.taxaAgendamento > data.taxaAgendamento ? 'up' : 'down'}">
                                    ${tendencia.taxaAgendamento > data.taxaAgendamento ? '‚Üó' : '‚Üò'} Tend√™ncia: ${formatPercent(tendencia.taxaAgendamento)}
                                </div>
                            ` : ''}
                        </span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Taxa de Comparecimento</span>
                        <span class="stat-value">
                            ${formatPercent(data.taxaComparecimento)}
                            ${tendencia ? `
                                <div class="trend-indicator ${tendencia.taxaComparecimento > data.taxaComparecimento ? 'up' : 'down'}">
                                    ${tendencia.taxaComparecimento > data.taxaComparecimento ? '‚Üó' : '‚Üò'} Tend√™ncia: ${formatPercent(tendencia.taxaComparecimento)}
                                </div>
                            ` : ''}
                        </span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Taxa de Ascens√£o</span>
                        <span class="stat-value ${data.taxaAscensao >= 10 ? 'positive' : 'negative'}">
                            ${formatPercent(data.taxaAscensao)}
                            ${tendencia ? `
                                <div class="trend-indicator ${tendencia.taxaAscensao > data.taxaAscensao ? 'up' : 'down'}">
                                    ${tendencia.taxaAscensao > data.taxaAscensao ? '‚Üó' : '‚Üò'} Tend√™ncia: ${formatPercent(tendencia.taxaAscensao)}
                                </div>
                            ` : ''}
                        </span>
                    </div>
                </div>

                <!-- Bloco Convers√£o -->
                <div class="stats-block">
                    <div class="stats-block-title">üéØ CONVERS√ÉO</div>
                    <div class="stat-item">
                        <span class="stat-label">Venda Monetiza√ß√£o</span>
                        <span class="stat-value">${formatNumber(data.vendaMonetizacao)}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">Entrada Monetiza√ß√£o</span>
                        <span class="stat-value">${formatNumber(data.entradaMonetizacao)}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">N√∫mero de Venda</span>
                        <span class="stat-value">${formatNumber(data.numeroVenda)}</span>
                    </div>
                </div>
            `;
        }

        function renderBottomCards(data) {
            const container = document.getElementById('bottomCards');
            
            const cards = [
                { title: 'Alunos', value: formatNumber(data.alunos), icon: 'üéì', color: '#3b82f6' },
                { title: 'Qualificados', value: formatNumber(data.qualificados), icon: '‚úÖ', color: '#10b981' },
                { title: 'Agendados', value: formatNumber(data.agendados), icon: 'üìÖ', color: '#f59e0b' },
                { title: 'Call Realizada', value: formatNumber(data.callRealizada), icon: 'üìû', color: '#8b5cf6' }
            ];
            
            container.innerHTML = cards.map(card => `
                <div class="metric-card">
                    <div class="metric-card-header">
                        <span class="metric-card-title">${card.title}</span>
                        <span class="metric-card-icon">${card.icon}</span>
                    </div>
                    <div class="metric-card-value" style="color: ${card.color};">
                        ${card.value}
                    </div>
                </div>
            `).join('');
        }

        // ==================== RANKINGS ====================
        function renderRankings() {
            const container = document.getElementById('rankingGrid');
            const monthData = allData[currentMonth];
            
            if (!monthData) return;
            
            const products = ['50 Scripts', 'Couply', 'Social Selling CL', 'Teste', 
                            'IA Julia', 'MPM', 'Autentiq', 'Mentoria Julia', 'Social Selling JU'];
            
            // Ranking por Faturamento
            const byFaturamento = products
                .map(p => ({ name: p, value: monthData[p]?.total?.faturamento || 0 }))
                .sort((a, b) => b.value - a.value)
                .slice(0, 3);
            
            // Ranking por ROI
            const byROI = products
                .map(p => ({ name: p, value: monthData[p]?.total?.roi || 0 }))
                .sort((a, b) => b.value - a.value)
                .slice(0, 3);
            
            // Ranking por Alunos
            const byAlunos = products
                .map(p => ({ name: p, value: monthData[p]?.total?.alunos || 0 }))
                .sort((a, b) => b.value - a.value)
                .slice(0, 3);
            
            // Ranking por Taxa de Convers√£o (Ascens√£o)
            const byConversao = products
                .map(p => ({ name: p, value: monthData[p]?.total?.taxaAscensao || 0 }))
                .sort((a, b) => b.value - a.value)
                .slice(0, 3);

            // Ranking por Taxa de Comparecimento
            const byComparecimento = products
                .map(p => ({ name: p, value: monthData[p]?.total?.taxaComparecimento || 0 }))
                .sort((a, b) => b.value - a.value)
                .slice(0, 3);
            
            container.innerHTML = `
                ${renderRankingCard('üí∞ Maior Faturamento', byFaturamento, formatCurrency)}
                ${renderRankingCard('üìà Melhor ROI', byROI, formatPercent)}
                ${renderRankingCard('üéì Mais Alunos', byAlunos, formatNumber)}
                ${renderRankingCard('üéØ Melhor Taxa de Convers√£o', byConversao, formatPercent)}
                ${renderRankingCard('‚úÖ Melhor Taxa de Comparecimento', byComparecimento, formatPercent)}
            `;
        }

        function renderRankingCard(title, items, formatter) {
            const positions = ['gold', 'silver', 'bronze'];
            const medals = ['ü•á', 'ü•à', 'ü•â'];
            
            return `
                <div class="ranking-card">
                    <div class="ranking-card-title">${title}</div>
                    ${items.map((item, index) => `
                        <div class="ranking-item">
                            <div class="ranking-position ${positions[index]}">
                                ${medals[index]}
                            </div>
                            <div class="ranking-info">
                                <div class="ranking-product-name">${item.name}</div>
                                <div class="ranking-value">${formatter(item.value)}</div>
                            </div>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        // ==================== M√ìDULOS ====================
        function showModule(moduleName) {
            document.querySelectorAll('.module-view').forEach(module => {
                module.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(`module-${moduleName}`).classList.add('active');
            event.target.classList.add('active');
            
            // Carregar dados do m√≥dulo espec√≠fico
            if (moduleName === 'roi') {
                renderROIModule();
            } else if (moduleName === 'custos') {
                renderCustosModule();
            } else if (moduleName === 'insights') {
                renderInsights();
            } else if (moduleName === 'comparar-funis') {
                updateFunilComparison();
            } else if (moduleName === 'comparar-meses') {
                updateMonthComparison();
            }
        }

        function renderROIModule() {
            const container = document.getElementById('roiGrid');
            const monthData = allData[currentMonth];
            
            if (!monthData) return;
            
            const products = ['Total Cleiton', 'Total Julia', '50 Scripts', 'Couply', 
                            'Social Selling CL', 'Teste', 'IA Julia', 'MPM', 
                            'Autentiq', 'Mentoria Julia', 'Social Selling JU'];
            
            container.innerHTML = products.map(product => {
                const data = monthData[product]?.total;
                if (!data) return '';
                
                const productInfo = allProducts.find(p => p.id === product);
                
                return `
                    <div class="roi-card">
                        <div class="roi-card-header">
                            <span class="roi-card-name">${product}</span>
                            <span class="roi-card-icon">${productInfo?.icon || 'üìä'}</span>
                        </div>
                        <div class="roi-metrics">
                            <div class="roi-metric">
                                <span class="roi-metric-label">Investido</span>
                                <span class="roi-metric-value">${formatCurrency(data.investido)}</span>
                            </div>
                            <div class="roi-metric">
                                <span class="roi-metric-label">Faturamento</span>
                                <span class="roi-metric-value">${formatCurrency(data.faturamento)}</span>
                            </div>
                            <div class="roi-metric">
                                <span class="roi-metric-label">Lucro</span>
                                <span class="roi-metric-value ${data.lucro >= 0 ? 'profit' : 'loss'}">
                                    ${formatCurrency(data.lucro)}
                                </span>
                            </div>
                            <div class="roi-metric">
                                <span class="roi-metric-label">ROI</span>
                                <span class="roi-metric-value ${data.roi >= 0 ? 'profit' : 'loss'}">
                                    ${formatPercent(data.roi)}
                                </span>
                            </div>
                            <div class="roi-metric">
                                <span class="roi-metric-label">ROAS</span>
                                <span class="roi-metric-value">${data.roas.toFixed(2)}x</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderCustosModule() {
            const container = document.getElementById('custosGrid');
            const monthData = allData[currentMonth];
            
            if (!monthData) return;
            
            const products = ['Total Cleiton', 'Total Julia', '50 Scripts', 'Couply', 
                            'Social Selling CL', 'Teste', 'IA Julia', 'MPM', 
                            'Autentiq', 'Mentoria Julia', 'Social Selling JU'];
            
            container.innerHTML = products.map(product => {
                const data = monthData[product]?.total;
                if (!data) return '';
                
                const productInfo = allProducts.find(p => p.id === product);
                
                const custoQualificado = data.qualificados > 0 ? data.investido / data.qualificados : 0;
                const custoAgendado = data.agendados > 0 ? data.investido / data.agendados : 0;
                const custoAluno = data.alunos > 0 ? data.investido / data.alunos : 0;
                
                return `
                    <div class="roi-card">
                        <div class="roi-card-header">
                            <span class="roi-card-name">${product}</span>
                            <span class="roi-card-icon">${productInfo?.icon || 'üìä'}</span>
                        </div>
                        <div class="roi-metrics">
                            <div class="roi-metric">
                                <span class="roi-metric-label">Custo por Qualificado</span>
                                <span class="roi-metric-value">${formatCurrency(custoQualificado)}</span>
                            </div>
                            <div class="roi-metric">
                                <span class="roi-metric-label">Custo por Agendado</span>
                                <span class="roi-metric-value">${formatCurrency(custoAgendado)}</span>
                            </div>
                            <div class="roi-metric">
                                <span class="roi-metric-label">CAC (Custo por Aluno)</span>
                                <span class="roi-metric-value">${formatCurrency(custoAluno)}</span>
                            </div>
                            <div class="roi-metric">
                                <span class="roi-metric-label">Total Investido</span>
                                <span class="roi-metric-value">${formatCurrency(data.investido)}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderInsights() {
            const container = document.getElementById('insightsContainer');
            const monthData = allData[currentMonth];
            
            if (!monthData) return;
            
            const insights = [];
            
            // Insight: Melhor e Pior Performer
            const products = ['50 Scripts', 'Couply', 'Social Selling CL', 'Teste', 
                            'IA Julia', 'MPM', 'Autentiq', 'Mentoria Julia', 'Social Selling JU'];
            
            const byROI = products
                .map(p => ({ name: p, roi: monthData[p]?.total?.roi || 0 }))
                .sort((a, b) => b.roi - a.roi);
            
            const bestROI = byROI[0];
            const worstROI = byROI[byROI.length - 1];
            
            insights.push({
                type: 'positive',
                icon: 'üèÜ',
                title: 'Melhor Performance',
                description: `${bestROI.name} est√° liderando com ROI de ${formatPercent(bestROI.roi)}!`,
                data: []
            });
            
            if (worstROI.roi < 0) {
                insights.push({
                    type: 'negative',
                    icon: '‚ö†Ô∏è',
                    title: 'Aten√ß√£o Necess√°ria',
                    description: `${worstROI.name} est√° com ROI negativo de ${formatPercent(worstROI.roi)}. Considere revisar a estrat√©gia.`,
                    data: []
                });
            }
            
            // Insight: Taxa de Convers√£o Baixa
            const lowConversion = products
                .map(p => ({ 
                    name: p, 
                    taxa: monthData[p]?.total?.taxaAscensao || 0,
                    alunos: monthData[p]?.total?.alunos || 0
                }))
                .filter(p => p.taxa < 10 && p.alunos > 0)
                .sort((a, b) => a.taxa - b.taxa);
            
            if (lowConversion.length > 0) {
                const lowest = lowConversion[0];
                insights.push({
                    type: 'neutral',
                    icon: 'üìä',
                    title: 'Oportunidade de Melhoria',
                    description: `${lowest.name} tem taxa de convers√£o de apenas ${formatPercent(lowest.taxa)}. H√° potencial para otimiza√ß√£o.`,
                    data: []
                });
            }
            
            // Insight: Melhor Taxa de Comparecimento
            const byComparecimento = products
                .map(p => ({ name: p, taxa: monthData[p]?.total?.taxaComparecimento || 0 }))
                .sort((a, b) => b.taxa - a.taxa);
            
            const bestComparecimento = byComparecimento[0];
            if (bestComparecimento.taxa > 70) {
                insights.push({
                    type: 'positive',
                    icon: '‚úÖ',
                    title: 'Excelente Comparecimento',
                    description: `${bestComparecimento.name} tem taxa de comparecimento de ${formatPercent(bestComparecimento.taxa)}. Continue o bom trabalho!`,
                    data: []
                });
            }
            
            container.innerHTML = insights.map(insight => `
                <div class="insight-card ${insight.type}">
                    <div class="insight-header">
                        <span class="insight-icon">${insight.icon}</span>
                        <span class="insight-title">${insight.title}</span>
                    </div>
                    <div class="insight-description">${insight.description}</div>
                    ${insight.data.length > 0 ? `
                        <div class="insight-data">
                            ${insight.data.map(d => `
                                <div class="insight-data-item">${d}</div>
                            `).join('')}
                        </div>
                    ` : ''}
                </div>
            `).join('');
        }

        function updateFunilComparison() {
            const funil1 = document.getElementById('funil1Select').value;
            const funil2 = document.getElementById('funil2Select').value;
            const container = document.getElementById('comparisonGrid');
            const monthData = allData[currentMonth];
            
            if (!monthData) return;
            
            const data1 = monthData[funil1]?.total;
            const data2 = monthData[funil2]?.total;
            
            if (!data1 || !data2) return;
            
            const metrics = [
                { label: 'Investido', key: 'investido', format: formatCurrency },
                { label: 'Faturamento', key: 'faturamento', format: formatCurrency },
                { label: 'Lucro', key: 'lucro', format: formatCurrency },
                { label: 'ROI', key: 'roi', format: formatPercent },
                { label: 'ROAS', key: 'roas', format: (v) => `${v.toFixed(2)}x` },
                { label: 'Alunos', key: 'alunos', format: formatNumber },
                { label: 'Qualificados', key: 'qualificados', format: formatNumber },
                { label: 'Agendados', key: 'agendados', format: formatNumber },
                { label: 'Call Realizada', key: 'callRealizada', format: formatNumber },
                { label: 'Taxa Agendamento', key: 'taxaAgendamento', format: formatPercent },
                { label: 'Taxa Comparecimento', key: 'taxaComparecimento', format: formatPercent },
                { label: 'Taxa Ascens√£o', key: 'taxaAscensao', format: formatPercent }
            ];
            
            container.innerHTML = `
                <div class="comparison-column">
                    <div class="comparison-column-header">
                        <div class="comparison-product-name">${funil1}</div>
                    </div>
                    <div class="comparison-metrics">
                        ${metrics.map(metric => `
                            <div class="comparison-metric">
                                <span class="comparison-metric-label">${metric.label}</span>
                                <span class="comparison-metric-value">
                                    ${metric.format(data1[metric.key])}
                                </span>
                            </div>
                        `).join('')}
                    </div>
                </div>
                
                <div class="comparison-column">
                    <div class="comparison-column-header">
                        <div class="comparison-product-name">${funil2}</div>
                    </div>
                    <div class="comparison-metrics">
                        ${metrics.map(metric => `
                            <div class="comparison-metric">
                                <span class="comparison-metric-label">${metric.label}</span>
                                <span class="comparison-metric-value">
                                    ${metric.format(data2[metric.key])}
                                </span>
                            </div>
                        `).join('')}
                    </div>
                </div>
            `;
        }

        function updateMonthComparison() {
            showToast('Info', 'Compara√ß√£o de meses dispon√≠vel apenas para Novembro no momento', 'info', 3000);
        }

        // ==================== EXPORTA√á√ÉO ====================
        function exportData(format) {
            showToast('Info', `Exporta√ß√£o ${format.toUpperCase()} em desenvolvimento`, 'info', 3000);
        }

        // ==================== INICIALIZA√á√ÉO ====================
        window.addEventListener('DOMContentLoaded', () => {
            loadSheetData();
        });
    </script>
</body>
</html>
