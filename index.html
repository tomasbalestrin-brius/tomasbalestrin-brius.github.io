<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acompanhamento Geral Funis - An√°lise Completa</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
            min-height: 100vh;
            color: white;
            padding: 30px 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .header h1 {
            font-size: 3.5rem;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 15px;
            font-weight: 800;
            text-shadow: 0 4px 20px rgba(59, 130, 246, 0.3);
            filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.4));
        }

        .header p {
            font-size: 1.2rem;
            color: #94a3b8;
            margin-bottom: 10px;
        }

        .month-selector {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .month-btn {
            padding: 16px 35px;
            border: 2px solid #475569;
            border-radius: 10px;
            background: #1e293b;
            color: #e2e8f0;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
        }

        .month-btn:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .month-btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: white;
        }

        .team-selector {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin-bottom: 35px;
        }

        .team-btn {
            padding: 25px 60px;
            border: 3px solid #475569;
            border-radius: 16px;
            font-size: 1.5rem;
            font-weight: 800;
            cursor: pointer;
            transition: all 0.3s;
            background: #1e293b;
            color: #e2e8f0;
        }

        .team-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.4);
        }

        .team-btn.active {
            background: linear-gradient(45deg, #8b5cf6, #a855f7);
            border-color: #8b5cf6;
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.5);
        }

        .team-btn.geral-btn {
            background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%);
            border-color: #3b82f6;
        }

        .team-btn.geral-btn.active {
            background: linear-gradient(45deg, #3b82f6, #60a5fa);
            border-color: #3b82f6;
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.5);
        }

        .product-selector {
            display: flex;
            justify-content: center;
            gap: 18px;
            margin-bottom: 35px;
            flex-wrap: wrap;
        }

        .product-btn {
            padding: 18px 38px;
            border: none;
            border-radius: 14px;
            font-size: 1.15rem;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s;
            background: #334155;
            color: #e2e8f0;
        }

        .product-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
        }

        .product-btn.active {
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.4);
        }

        .dashboard-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
            margin-bottom: 30px;
        }

        .main-chart {
            background: #1e293b;
            border-radius: 16px;
            padding: 25px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .chart-title {
            font-size: 1.5rem;
            color: #e2e8f0;
        }

        .week-selector {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .week-selector label {
            color: #94a3b8;
            font-size: 0.9rem;
            font-weight: 600;
        }

        .week-selector select {
            padding: 8px 15px;
            border-radius: 8px;
            border: 2px solid #475569;
            background: #0f172a;
            color: #e2e8f0;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .week-selector select:hover {
            border-color: #3b82f6;
        }

        .week-selector select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        /* Estilo do Funil */
        .funnel-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            padding: 20px 0;
        }

        .funnel-stage {
            width: 100%;
            text-align: center;
            padding: 20px;
            border-radius: 8px;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
        }

        .funnel-stage:hover {
            transform: scale(1.02);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .funnel-stage-1 {
            width: 100%;
            background: linear-gradient(135deg, #059669 0%, #10b981 100%);
        }

        .funnel-stage-2 {
            width: 85%;
            background: linear-gradient(135deg, #0891b2 0%, #06b6d4 100%);
        }

        .funnel-stage-3 {
            width: 70%;
            background: linear-gradient(135deg, #2563eb 0%, #3b82f6 100%);
        }

        .funnel-stage-4 {
            width: 55%;
            background: linear-gradient(135deg, #7c3aed 0%, #8b5cf6 100%);
        }

        .funnel-stage-5 {
            width: 40%;
            background: linear-gradient(135deg, #c026d3 0%, #d946ef 100%);
        }

        .funnel-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-bottom: 5px;
        }

        .funnel-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .funnel-percent {
            font-size: 1.1rem;
            opacity: 0.8;
        }

        .funnel-arrow {
            font-size: 2rem;
            color: #94a3b8;
            margin: -10px 0;
        }

        .stats-panel {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .stat-card {
            background: #1e293b;
            padding: 20px;
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
        }

        .stat-label {
            color: #94a3b8;
            font-size: 0.85rem;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-size: 1.6rem;
            font-weight: bold;
            color: #e2e8f0;
        }

        .stat-value.positive {
            color: #10b981;
        }

        .stat-value.negative {
            color: #ef4444;
        }

        .stats-block {
            background: #1e293b;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #3b82f6;
            margin-bottom: 15px;
        }

        .stats-block.aquisicao {
            border-left-color: #8b5cf6;
        }

        .stats-block.monetizacao {
            border-left-color: #10b981;
        }

        .stats-block.tendencia {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
            border-left-width: 3px;
            border-style: dashed;
            padding: 20px;
            opacity: 0.95;
        }

        .stats-block.tendencia.aquisicao {
            border-left-color: #a78bfa;
        }

        .stats-block.tendencia.monetizacao {
            border-left-color: #34d399;
        }

        .stats-block-title {
            font-size: 1.2rem;
            font-weight: 700;
            color: #e2e8f0;
            margin-bottom: 18px;
            text-transform: uppercase;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .stats-block.tendencia .stats-block-title {
            font-size: 1rem;
            color: #cbd5e1;
            margin-bottom: 15px;
        }

        .stats-block-title::before {
            content: '{';
            font-size: 2.5rem;
            color: #3b82f6;
            line-height: 1;
        }

        .stats-block.tendencia .stats-block-title::before {
            content: '‚Üó';
            font-size: 2rem;
            opacity: 0.7;
        }

        .stats-block.aquisicao .stats-block-title::before {
            color: #8b5cf6;
        }

        .stats-block.monetizacao .stats-block-title::before {
            color: #10b981;
        }

        .stats-block.tendencia.aquisicao .stats-block-title::before {
            color: #a78bfa;
        }

        .stats-block.tendencia.monetizacao .stats-block-title::before {
            color: #34d399;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px 0;
            border-bottom: 1px solid #334155;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stats-block.tendencia .stat-item {
            padding: 10px 0;
        }

        .stat-item-label {
            color: #94a3b8;
            font-size: 0.95rem;
            font-weight: 500;
        }

        .stats-block.tendencia .stat-item-label {
            font-size: 0.85rem;
            color: #94a3b8;
        }

        .stat-item-value {
            color: #e2e8f0;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .stats-block.tendencia .stat-item-value {
            font-size: 1rem;
            color: #cbd5e1;
        }

        .stat-item-value.positive {
            color: #10b981;
        }

        .stat-item-value.negative {
            color: #ef4444;
        }

        .bottom-cards {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }

        .bottom-card {
            background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            padding: 25px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #475569;
            transition: all 0.3s;
        }

        .bottom-card:hover {
            border-color: #3b82f6;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
        }

        .bottom-card.tendencia {
            background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 100%);
            border: 2px dashed #3b82f6;
        }

        .bottom-card.tendencia:hover {
            border-color: #60a5fa;
            box-shadow: 0 10px 30px rgba(96, 165, 250, 0.4);
        }

        .bottom-card-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .bottom-card-label {
            color: #94a3b8;
            font-size: 0.9rem;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .bottom-card-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #e2e8f0;
        }

        .ranking-section {
            background: #1e293b;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
        }

        .ranking-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            text-align: center;
            color: #e2e8f0;
        }

        .ranking-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .ranking-card {
            background: linear-gradient(135deg, #334155 0%, #1e293b 100%);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 2px solid #475569;
            transition: all 0.3s;
        }

        .ranking-card:hover {
            border-color: #3b82f6;
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.3);
        }

        .ranking-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .ranking-label {
            color: #94a3b8;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .ranking-product {
            font-size: 1.3rem;
            font-weight: bold;
            color: #e2e8f0;
            margin-bottom: 5px;
        }

        .ranking-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #3b82f6;
        }

        @media (max-width: 1200px) {
            .dashboard-content {
                grid-template-columns: 1fr;
            }
            .stats-panel {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            }
            .bottom-cards {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2.5rem;
            }
            
            .header p {
                font-size: 1rem;
            }
            
            .month-btn {
                padding: 14px 28px;
                font-size: 1rem;
            }
            
            .team-selector {
                flex-wrap: wrap;
            }
            
            .team-btn {
                padding: 20px 40px;
                font-size: 1.2rem;
            }
            
            .product-btn {
                padding: 15px 30px;
                font-size: 1rem;
            }
            
            .bottom-cards {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .team-selector {
                flex-direction: column;
                gap: 15px;
            }
            
            .team-btn {
                width: 100%;
                max-width: 300px;
                margin: 0 auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä ACOMPANHAMENTO GERAL FUNIS</h1>
            <p>An√°lise Completa de Performance por Produto</p>
        </div>

        <div class="month-selector" id="monthSelector"></div>

        <div class="team-selector">
            <button class="team-btn geral-btn active" onclick="selectTeam('geral')">
                üìä GERAL
            </button>
            <button class="team-btn" onclick="selectTeam('cleiton')">
                üë®‚Äçüíº CLEITON
            </button>
            <button class="team-btn" onclick="selectTeam('julia')">
                üë©‚Äçüíº JULIA
            </button>
        </div>

        <div class="product-selector" id="productSelector"></div>

        <div class="dashboard-content">
            <div class="main-chart">
                <div class="chart-header">
                    <h2 class="chart-title" id="chartTitle">Funil de Convers√£o</h2>
                    <div class="week-selector">
                        <label for="weekSelect">üìÖ Per√≠odo:</label>
                        <select id="weekSelect" onchange="updateFunnel()">
                            <option value="total">Total do M√™s</option>
                            <option value="1">Semana 1</option>
                            <option value="2">Semana 2</option>
                            <option value="3">Semana 3</option>
                            <option value="4">Semana 4</option>
                        </select>
                    </div>
                </div>
                <div id="funnelArea"></div>
            </div>

            <div class="stats-panel" id="statsPanel"></div>
        </div>

        <div class="bottom-cards" id="bottomCards"></div>

        <div class="ranking-section">
            <h2 class="ranking-title">üèÜ RANKING DE PRODUTOS - COMPARA√á√ÉO</h2>
            <div class="ranking-grid" id="rankingGrid"></div>
        </div>
    </div>

    <script>
        const SHEET_ID = '1V0-yWzGbDWUEQ21CPtNcHrzPQfLTXKHNBYUlSfzO2Pc';
        
        const MONTHS = [
            { id: 'out', name: 'Outubro', gid: '0' },
            { id: 'nov', name: 'Novembro', gid: '799831430' },
            { id: 'dez', name: 'Dezembro', gid: '1796217875' },
            { id: 'jan', name: 'Janeiro', gid: '1107738440' },
            { id: 'fev', name: 'Fevereiro', gid: '668056747' }
        ];

        const allProducts = [
            { id: 'Geral', name: 'Geral', icon: 'üìä', team: 'geral' },
            { id: '50 Scripts', name: '50 Scripts', icon: 'üìù', team: 'cleiton' },
            { id: 'Couply', name: 'Couply', icon: 'üíë', team: 'cleiton' },
            { id: 'Teste', name: 'Teste', icon: 'üß™', team: 'julia' },
            { id: 'IA Julia', name: 'IA Julia', icon: 'ü§ñ', team: 'julia' },
            { id: 'MPM', name: 'MPM', icon: 'üìä', team: 'julia' }
        ];

        let currentMonth = 'nov';
        let currentTeam = 'geral';
        let currentProduct = 'Geral';
        let currentWeek = 'total';
        let allData = {};

        async function loadData() {
            const month = MONTHS.find(m => m.id === currentMonth);
            if (!month) return;

            const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${month.gid}`;
            
            try {
                const response = await fetch(url);
                const csvText = await response.text();
                
                Papa.parse(csvText, {
                    complete: function(results) {
                        parseSheetData(results.data);
                        renderUI();
                    }
                });
            } catch (error) {
                console.error('Erro ao carregar dados:', error);
            }
        }

        function parseSheetData(data) {
            const productRanges = {
                'Geral': { start: 2, end: 5, tendencia: 6 },
                '50 Scripts': { start: 9, end: 12, tendencia: 13 },
                'Teste': { start: 16, end: 19, tendencia: 20 },
                'IA Julia': { start: 23, end: 26, tendencia: 27 },
                'MPM': { start: 30, end: 33, tendencia: 34 },
                'Couply': { start: 37, end: 40, tendencia: 41 }
            };

            allData = {};

            for (const [productName, range] of Object.entries(productRanges)) {
                const semanas = [];
                
                for (let i = range.start; i <= range.end; i++) {
                    const row = data[i];
                    if (!row) continue;
                    semanas.push(parseRow(row));
                }

                const tendenciaRow = data[range.tendencia];
                const tendencia = tendenciaRow ? parseRow(tendenciaRow) : null;

                allData[productName] = { semanas, tendencia };
            }
        }

        function parseRow(row) {
            const parseValue = (val) => {
                if (!val || val === '#N/A' || val === '#DIV/0!') return 0;
                let cleanVal = val.toString().replace(/[^\d,.-]/g, '');
                cleanVal = cleanVal.replace(/\./g, '');
                cleanVal = cleanVal.replace(',', '.');
                return parseFloat(cleanVal) || 0;
            };

            return {
                investido: parseValue(row[1]),           // Coluna B
                faturamentoTrafego: parseValue(row[2]),  // Coluna C
                roasTrafego: parseValue(row[3]),         // Coluna D (Lucro Tr√°fego)
                alunos: parseValue(row[4]),              // Coluna E
                qualificados: parseValue(row[5]),        // Coluna F
                agendados: parseValue(row[6]),           // Coluna G
                taxaAgendamento: parseValue(row[7]),     // Coluna H
                callRealizada: parseValue(row[8]),       // Coluna I
                taxaComparecimento: parseValue(row[9]),  // Coluna J
                numeroVenda: parseValue(row[10]),        // Coluna K
                taxaConversao: parseValue(row[11]),      // Coluna L
                taxaAscensao: parseValue(row[12]),       // Coluna M
                vendaMonetizacao: parseValue(row[13]),   // Coluna N
                entradas: parseValue(row[14]),           // Coluna O
                faturamentoFunil: parseValue(row[15]),   // Coluna P
                lucroFunil: parseValue(row[16])          // Coluna Q (Roas do funil)
            };
        }

        function renderUI() {
            renderMonthButtons();
            renderProductButtons();
            renderStatsPanel();
            updateFunnel();
            renderBottomCards();
            renderRanking();
        }

        function renderMonthButtons() {
            const container = document.getElementById('monthSelector');
            container.innerHTML = MONTHS.map(month => `
                <button class="month-btn ${month.id === currentMonth ? 'active' : ''}" 
                        onclick="selectMonth('${month.id}')">
                    ${month.name}
                </button>
            `).join('');
        }

        function renderProductButtons() {
            const container = document.getElementById('productSelector');
            
            // Se o time for geral, n√£o mostra bot√µes de produtos
            if (currentTeam === 'geral') {
                container.innerHTML = '';
                return;
            }
            
            const teamProducts = allProducts.filter(p => p.team === currentTeam);
            
            container.innerHTML = teamProducts.map(product => `
                <button class="product-btn ${product.id === currentProduct ? 'active' : ''}" 
                        onclick="selectProduct('${product.id}')">
                    ${product.icon} ${product.name}
                </button>
            `).join('');
        }

        function renderStatsPanel() {
            const data = allData[currentProduct];
            if (!data) return;

            const { semanas, tendencia } = data;
            
            const totalFaturamentoTrafego = semanas.reduce((sum, s) => sum + s.faturamentoTrafego, 0);
            const totalInvestido = semanas.reduce((sum, s) => sum + s.investido, 0);
            const totalRoasTrafego = semanas.reduce((sum, s) => sum + s.roasTrafego, 0);
            const totalVendaMonetizacao = semanas.reduce((sum, s) => sum + s.vendaMonetizacao, 0);
            const totalEntradas = semanas.reduce((sum, s) => sum + s.entradas, 0);

            const container = document.getElementById('statsPanel');
            
            let html = `
                <div class="stats-block aquisicao">
                    <div class="stats-block-title">üéØ AQUISI√á√ÉO</div>
                    <div class="stat-item">
                        <span class="stat-item-label">üí∞ Faturamento Tr√°fego</span>
                        <span class="stat-item-value">R$ ${totalFaturamentoTrafego.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-item-label">üí∏ Investimento</span>
                        <span class="stat-item-value">R$ ${totalInvestido.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-item-label">üìä Lucro Tr√°fego</span>
                        <span class="stat-item-value ${totalRoasTrafego >= 0 ? 'positive' : 'negative'}">R$ ${totalRoasTrafego.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                    </div>
                </div>
            `;

            // Adiciona tend√™ncia de aquisi√ß√£o se existir
            if (tendencia) {
                html += `
                    <div class="stats-block tendencia aquisicao">
                        <div class="stats-block-title">üìà TEND√äNCIA AQUISI√á√ÉO</div>
                        <div class="stat-item">
                            <span class="stat-item-label">üí∞ Faturamento Tr√°fego</span>
                            <span class="stat-item-value">R$ ${tendencia.faturamentoTrafego.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-item-label">üí∏ Investimento</span>
                            <span class="stat-item-value">R$ ${tendencia.investido.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-item-label">üìä Lucro Tr√°fego</span>
                            <span class="stat-item-value ${tendencia.roasTrafego >= 0 ? 'positive' : 'negative'}">R$ ${tendencia.roasTrafego.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                        </div>
                    </div>
                `;
            }

            html += `
                <div class="stats-block monetizacao">
                    <div class="stats-block-title">üíµ MONETIZA√á√ÉO</div>
                    <div class="stat-item">
                        <span class="stat-item-label">üí≥ Faturamento Monetiza√ß√£o</span>
                        <span class="stat-item-value">R$ ${totalVendaMonetizacao.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-item-label">üì• Entradas</span>
                        <span class="stat-item-value">R$ ${totalEntradas.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                    </div>
                </div>
            `;

            // Adiciona tend√™ncia de monetiza√ß√£o se existir
            if (tendencia) {
                html += `
                    <div class="stats-block tendencia monetizacao">
                        <div class="stats-block-title">üìà TEND√äNCIA MONETIZA√á√ÉO</div>
                        <div class="stat-item">
                            <span class="stat-item-label">üí≥ Faturamento Monetiza√ß√£o</span>
                            <span class="stat-item-value">R$ ${tendencia.vendaMonetizacao.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                        </div>
                        <div class="stat-item">
                            <span class="stat-item-label">üì• Entradas</span>
                            <span class="stat-item-value">R$ ${tendencia.entradas.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</span>
                        </div>
                    </div>
                `;
            }

            container.innerHTML = html;
        }

        function updateFunnel() {
            const data = allData[currentProduct];
            if (!data) return;

            const { semanas } = data;
            currentWeek = document.getElementById('weekSelect').value;

            let dataToShow;
            if (currentWeek === 'total') {
                dataToShow = {
                    alunos: semanas.reduce((sum, s) => sum + s.alunos, 0),
                    qualificados: semanas.reduce((sum, s) => sum + s.qualificados, 0),
                    agendados: semanas.reduce((sum, s) => sum + s.agendados, 0),
                    callRealizada: semanas.reduce((sum, s) => sum + s.callRealizada, 0),
                    vendas: semanas.reduce((sum, s) => sum + s.numeroVenda, 0)
                };
            } else {
                const weekIndex = parseInt(currentWeek) - 1;
                if (semanas[weekIndex]) {
                    const semana = semanas[weekIndex];
                    dataToShow = {
                        alunos: semana.alunos,
                        qualificados: semana.qualificados,
                        agendados: semana.agendados,
                        callRealizada: semana.callRealizada,
                        vendas: semana.numeroVenda
                    };
                } else {
                    dataToShow = { alunos: 0, qualificados: 0, agendados: 0, callRealizada: 0, vendas: 0 };
                }
            }

            renderFunnel(dataToShow);
        }

        function renderFunnel(data) {
            const funnelArea = document.getElementById('funnelArea');
            const chartTitle = document.getElementById('chartTitle');
            
            const periodText = currentWeek === 'total' ? 'Total do M√™s' : `Semana ${currentWeek}`;
            chartTitle.textContent = `Funil de Convers√£o - ${currentProduct} (${periodText})`;

            const { alunos, qualificados, agendados, callRealizada, vendas } = data;

            funnelArea.innerHTML = `
                <div class="funnel-container">
                    <div class="funnel-stage funnel-stage-1">
                        <div class="funnel-label">üë• Alunos</div>
                        <div class="funnel-value">${alunos}</div>
                        <div class="funnel-percent">100%</div>
                    </div>
                    <div class="funnel-arrow">‚ñº</div>
                    <div class="funnel-stage funnel-stage-2">
                        <div class="funnel-label">‚úÖ Qualificados</div>
                        <div class="funnel-value">${qualificados}</div>
                        <div class="funnel-percent">${alunos > 0 ? ((qualificados / alunos) * 100).toFixed(1) : 0}%</div>
                    </div>
                    <div class="funnel-arrow">‚ñº</div>
                    <div class="funnel-stage funnel-stage-3">
                        <div class="funnel-label">üìÖ Call Agendadas</div>
                        <div class="funnel-value">${agendados}</div>
                        <div class="funnel-percent">${qualificados > 0 ? ((agendados / qualificados) * 100).toFixed(1) : 0}%</div>
                    </div>
                    <div class="funnel-arrow">‚ñº</div>
                    <div class="funnel-stage funnel-stage-4">
                        <div class="funnel-label">üìû Call Realizadas</div>
                        <div class="funnel-value">${callRealizada}</div>
                        <div class="funnel-percent">${agendados > 0 ? ((callRealizada / agendados) * 100).toFixed(1) : 0}%</div>
                    </div>
                    <div class="funnel-arrow">‚ñº</div>
                    <div class="funnel-stage funnel-stage-5">
                        <div class="funnel-label">üíº Vendas</div>
                        <div class="funnel-value">${vendas}</div>
                        <div class="funnel-percent">${callRealizada > 0 ? ((vendas / callRealizada) * 100).toFixed(1) : 0}%</div>
                    </div>
                </div>
            `;
        }

        function renderBottomCards() {
            const data = allData[currentProduct];
            if (!data) return;

            const { semanas, tendencia } = data;
            
            const totalFaturamentoFunil = semanas.reduce((sum, s) => sum + s.faturamentoFunil, 0);
            const totalLucroFunil = semanas.reduce((sum, s) => sum + s.lucroFunil, 0);

            const tendenciaFaturamento = tendencia ? tendencia.faturamentoFunil : 0;
            const tendenciaLucro = tendencia ? tendencia.lucroFunil : 0;

            const container = document.getElementById('bottomCards');
            container.innerHTML = `
                <div class="bottom-card">
                    <div class="bottom-card-icon">üíµ</div>
                    <div class="bottom-card-label">Faturamento do Funil</div>
                    <div class="bottom-card-value">R$ ${totalFaturamentoFunil.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                </div>
                <div class="bottom-card tendencia">
                    <div class="bottom-card-icon">üìà</div>
                    <div class="bottom-card-label">Tend√™ncia Faturamento</div>
                    <div class="bottom-card-value" style="color: #60a5fa;">R$ ${tendenciaFaturamento.toLocaleString('pt-BR', {minimumFractionDigits: 2})}</div>
                </div>
                <div class="bottom-card">
                    <div class="bottom-card-icon">üìä</div>
                    <div class="bottom-card-label">Lucro do Funil</div>
                    <div class="bottom-card-value" style="color: ${totalLucroFunil >= 0 ? '#10b981' : '#ef4444'}">
                        R$ ${totalLucroFunil.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                    </div>
                </div>
                <div class="bottom-card tendencia">
                    <div class="bottom-card-icon">üìà</div>
                    <div class="bottom-card-label">Tend√™ncia Lucro</div>
                    <div class="bottom-card-value" style="color: ${tendenciaLucro >= 0 ? '#34d399' : '#f87171'};">
                        R$ ${tendenciaLucro.toLocaleString('pt-BR', {minimumFractionDigits: 2})}
                    </div>
                </div>
            `;
        }

        function renderRanking() {
            const container = document.getElementById('rankingGrid');
            
            const produtosRanking = allProducts.map(product => {
                const data = allData[product.id];
                if (!data) return null;

                const { semanas } = data;
                const totalInvestido = semanas.reduce((sum, s) => sum + s.investido, 0);
                const totalFaturamentoTrafego = semanas.reduce((sum, s) => sum + s.faturamentoTrafego, 0);
                const totalFaturamentoFunil = semanas.reduce((sum, s) => sum + s.faturamentoFunil, 0);
                const totalLucroFunil = semanas.reduce((sum, s) => sum + s.lucroFunil, 0);
                const totalLucroTrafego = semanas.reduce((sum, s) => sum + s.roasTrafego, 0);
                const totalVendas = semanas.reduce((sum, s) => sum + s.numeroVenda, 0);
                const totalVendaMonetizacao = semanas.reduce((sum, s) => sum + s.vendaMonetizacao, 0);
                const roasMedio = totalInvestido > 0 ? totalFaturamentoTrafego / totalInvestido : 0;

                return {
                    ...product,
                    totalInvestido,
                    totalFaturamentoTrafego,
                    totalFaturamentoFunil,
                    totalLucroFunil,
                    totalLucroTrafego,
                    totalVendas,
                    totalVendaMonetizacao,
                    roasMedio
                };
            }).filter(p => p !== null);

            const rankings = [
                { 
                    title: 'üí∞ Maior Faturamento Tr√°fego', 
                    icon: 'üëë', 
                    key: 'totalFaturamentoTrafego',
                    format: (val) => `R$ ${val.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`
                },
                { 
                    title: 'üíµ Maior Faturamento do Funil', 
                    icon: 'üèÜ', 
                    key: 'totalFaturamentoFunil',
                    format: (val) => `R$ ${val.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`
                },
                { 
                    title: 'üìä Maior Lucro do Funil', 
                    icon: 'üíé', 
                    key: 'totalLucroFunil',
                    format: (val) => `R$ ${val.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`
                },
                { 
                    title: 'üéØ Melhor ROAS', 
                    icon: 'üåü', 
                    key: 'roasMedio',
                    format: (val) => `${val.toFixed(2)}x`
                },
                { 
                    title: 'üíº Mais Vendas', 
                    icon: 'üöÄ', 
                    key: 'totalVendas',
                    format: (val) => `${val} vendas`
                },
                { 
                    title: 'üí≥ Maior Faturamento Monetiza√ß√£o', 
                    icon: 'üí∞', 
                    key: 'totalVendaMonetizacao',
                    format: (val) => `R$ ${val.toLocaleString('pt-BR', {minimumFractionDigits: 2})}`
                }
            ];

            container.innerHTML = rankings.map(ranking => {
                const sorted = [...produtosRanking].sort((a, b) => b[ranking.key] - a[ranking.key]);
                const winner = sorted[0];

                return `
                    <div class="ranking-card">
                        <div class="ranking-icon">${ranking.icon}</div>
                        <div class="ranking-label">${ranking.title}</div>
                        <div class="ranking-product">${winner.icon} ${winner.name}</div>
                        <div class="ranking-value">${ranking.format(winner[ranking.key])}</div>
                    </div>
                `;
            }).join('');
        }

        function selectMonth(monthId) {
            currentMonth = monthId;
            loadData();
        }

        function selectTeam(team) {
            currentTeam = team;
            
            // Atualiza os bot√µes de time
            document.querySelectorAll('.team-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Seleciona o produto adequado para cada time
            if (team === 'geral') {
                currentProduct = 'Geral';
            } else {
                const teamProducts = allProducts.filter(p => p.team === team);
                if (teamProducts.length > 0) {
                    currentProduct = teamProducts[0].id;
                }
            }
            
            renderUI();
        }

        function selectProduct(productId) {
            currentProduct = productId;
            renderUI();
        }

        loadData();
    </script>
</body>
</html>
